function analyse_path(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];switch(r[0]){case"a":{break};case"t":{break};case"q":{break};case"s":{break};case"c":{break};case"v":{throw'file path "v" not supported yet.';break};case"V":{throw'file path "V" not supported yet.';break};case"h":{throw'file path "h" not supported yet.';break};case"H":{throw'file path "H" not supported yet.';break};case"l":{throw'file path "l" not supported yet.';break};case"L":{t.push({x:r[1],y:r[2]});break};case"Z":case"z":{throw'file path "Z" not supported yet.';break};case"m":case"M":{t.push({x:r[1],y:r[2]});break}}}return t}function parseVmlPathString(e){var t=e.match(/[A-z]?([^A-z\s])+\s([^A-z\s])+/g);delete t["input"];delete t["index"];delete t["lastIndex"];var n=t.length;var r=[];for(var i=0;i<n;i++){var s=t[i];var o=false;s=s.replace(/^[A-z]{1}/ig,function(e){o=true;return e+" "});var u=[];if(!o){u.push("L")}var a=s.split(" ");for(var f=0;f<a.length;f++){u.push(a[f])}r.push(u)}return r}function visit_vml(e){var t=new Array;if(typeof e=="object"&&e.length){for(var n=0;n<e.length;n++){t=t.concat(visit_vml(e[n]))}}else{switch(e.type){case"path":{var r=e.attrs.path;var i=parseVmlPathString(r);t.push(["path_s",analyse_path(i),e]);break};case"circle":{t.push(["circle",{radius:e.attrs.r,cx:e.attrs.cx,cy:e.attrs.cy},e]);break};case"ellipse":{t.push(["ellipse",{rx:e.attrs.rx,ry:e.attrs.ry,cx:e.attrs.cx,cy:e.attrs.cy},e]);break};case"rect":{var s=[{x:e.attrs.x,y:e.attrs.y},{x:e.attrs.x+e.attrs.width,y:e.attrs.y},{x:e.attrs.x+e.attrs.width,y:e.attrs.y+e.attrs.height},{x:e.attrs.x,y:e.attrs.y+e.attrs.height}];t.push(["rect",s,e]);break}}}return t}function find_curves_in_path(e){var t=false;var n=0;var r=e.length;while(!t&&n<r){if(e[n][0]in["a","A","c","C","s","S","q","Q","t","T"]){}n++}return t}function visit_svg(e){var t=[];if(typeof e=="object"&&e.length){for(var n=0;n<e.length;n++){t=t.concat(visit_svg(e[n]))}}else{switch(e.type){case"path":{var r=analyse_path(e.attrs.path);if(find_curves_in_path(e.attrs.path)){t.push(["path_c",r,e])}else{t.push(["path_s",r,e])}break};case"circle":{t.push(["circle",{radius:e.attrs.r,cx:e.attrs.cx,cy:e.attrs.cy},e]);break};case"ellipse":{t.push(["ellipse",{rx:e.attrs.rx,ry:e.attrs.ry,cx:e.attrs.cx,cy:e.attrs.cy},e]);break};case"image":case"rect":{var i=[{x:e.attrs.x,y:e.attrs.y},{x:e.attrs.x+e.attrs.width,y:e.attrs.y},{x:e.attrs.x+e.attrs.width,y:e.attrs.y+e.attrs.height},{x:e.attrs.x,y:e.attrs.y+e.attrs.height}];t.push(["rect",i,e]);break}}}return t}function populate_polygons(e,t){var n=new Array;if(e.raphael.svg){n=visit_svg(t)}else{n=visit_vml(t)}return n}function raphaelcollision(e,t,n,r){var i=[];var s=populate_polygons(e,t);var o=s.length;for(var u=0;u<o;u++){var a=s[u];switch(a[0]){case"circle":{if(collide_circle(a[1],n,r)){i.push(a)}break};case"ellipse":{if(collide_ellipse(a[1],n,r)){i.push(a)}break};case"path_s":case"rect":{if(collide_polygon(a[1],n,r)){i.push(a)}break};default:{throw"unknown type : "+a[0]}}}return i}function collide_polygon(e,t,n){var r=false;var i=[];var s=e.length;for(var o=0;o<s;o++){if(e[o]!=null){i.push(e[o])}}s=i.length;var u=s-1;for(var o=-1;++o<s;u=o){var a=i[o].y<=n&&n<i[u].y;var f=i[u].y<=n&&n<i[o].y;var l=parseInt((i[u].x-i[o].x)*(n-i[o].y)/(i[u].y-i[o].y))+parseInt(i[o].x);var c=t<l;if((a||f)&&c){r=!r}}return r}function collide_circle(e,t,n){return e.radius>Math.sqrt(Math.pow(e.cx-t,2)+Math.pow(e.cy-n,2))}function collide_ellipse(e,t,n){return Math.pow(t-e.cx,2)/Math.pow(e.rx,2)+Math.pow(n-e.cy,2)/Math.pow(e.ry,2)<=1}